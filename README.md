# adt2fhir

Using the two XSLT files (/src/main/resources/ADT2MDS_FHIR.xsl and /src/main/resources/MDS2FHIR.xsl), XML Files conforming to ADT/GEKID (/src/main/resources/
ADT_GEKID_v2.1.*x*-dktk_v1.0.0.xsd ) can be transformed into FHIR resources conforming to [de.dktk.oncology 1.0.4](https://simplifier.net/packages/de.dktk.oncology/1.0.4).


###IMPORTANT

You should modify line 6 in the MDS2FHIR file (```<xsl:variable name="Lokal_DKTK_ID_Pat_System">http://dktk.dkfz.de/fhir/onco/core/CodeSystem/PseudonymArtCS</xsl:variable>```, replace http://fhir.example.org/LokaleTumorPatientenIds
with a local URL. You can just make one up, but note that this URL will be used as Identifier.system in the resulting FHIR Patient resources (Identifer.value will be the local ID from your ADT file, the value of *Patienten_Stammdaten/@Patient_ID*).
Also note that NO pseudonymization or anonymization takes place. If you need to e.g. pseudonymize the IDs, you should do so either by preprocessing the ADT or processing the FHIR resources before loading them into your local FHIR store. Note that the Patient id is also used als the technical (resource) id , not just in the identifier.
So if working with the FHIR resources, you also need to replace this id and update all references to the Patient.

Since not all entities in the XML schema have ids, some are generated by the XSLT processor. These will stay constant if the same file is transformed multiple times using the same processing engine, but may change if the structure
changes or another processor is used. Therefore, if you plan to load updates into your FHIR store, be careful that all entities you plan to update have Ids explicitly set in the ADT (e.g. Patient_ID).

One Output file is created for each Patient (´Bundle_{Patient_ID}.xml´) in the current directory.

Besides, self-contained transformation, you can use this projects Main method to perform the transformation. It expects an ADT XML input file. The two transformations are then applied and the resulting FHIR Bundles are stored in the project directory.

##Usage

###Manual:

For a manual transformation first apply ADT2MDS_FHIR.xsl to your ADT.xml data, then MDS2FHIR.xsl to the results of the first transformation.
You can download the Saxon XSL processor [here](http://saxon.sourceforge.net/#F10HE) (Java Version). Unpack and find the JAR called saxon-he-[version].jar
Call the JAR from the command line: ´java -jar path/to/jar/saxon-he-[version].jar -s:sorceFile.xml -xsl:tranformationFile.xsl`. Additional documentation can be found [here](https://www.saxonica.com/documentation/index.html#!using-xsl/commandline).

###Project

Check out this repo and run:

```sh
mvn clean install
```
The file **adt2fhir-*version-number*-jar-with-dependencies.jar** is then generated in your target folder.

###JAR

Run the Transformation based on JAR:

```sh
java -jar adt2fhir-*version-number*-jar-with-dependencies.jar
```

###Docker 
Beta - will be improved in the next release

Build and start a container:

```sh
docker build -t adt2fhir .
docker-compose up
```

## Notes

    Assumes: Patient, Sample, Diagnose always have an Id, other Ids are optional.
    
    -_Lokal_DKTK_ID_Pat_System_ needs to conform to https://www.hl7.org/fhir/datatypes.html#uri